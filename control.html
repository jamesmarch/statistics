<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Experimental Control: Statistics for Visual Thinkers</title>

    <!-- Favicons -->
    <link rel="shortcut icon" href="assets/images/favicon.png">
    <link rel="apple-touch-icon" href="assets/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="assets/images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="assets/images/apple-touch-icon-114x114.png">

    <!-- Bootstrap core CSS -->
    <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Work+Sans:400,500,600,700,300|Alegreya:400,400italic,700,700italic|Fira+Mono' rel='stylesheet' type='text/css'>

    <!-- Plugins -->
    <link href="assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="assets/css/ionicons.min.css" rel="stylesheet">
    <link href="assets/css/simpletextrotator.css" rel="stylesheet">
    <link href="assets/css/magnific-popup.css" rel="stylesheet">
    <link href="assets/css/owl.carousel.css" rel="stylesheet">
    <link href="assets/css/superslides.css" rel="stylesheet">
    <link href="assets/css/vertical.css" rel="stylesheet">
    <link href="assets/css/animate.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="assets/css/component.css" />


    <!-- Template core CSS -->
    <link href="assets/css/style.css" rel="stylesheet">

    <style type="text/css">
        .axis {
            font: 12px sans-serif;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        
        .label {
            fill: #777;
        }
        
        .ylabel {
            font: 12px sans-serif;
        }
        
        #tooltip {
            visibility: hidden;
            position: absolute;
            background-color: #333333;
            opacity: 0.8;
            border-radius: 4px;
            padding: 5px;
            z-index: 10;
            color: white;
            font-size: 14px;
        }
        
        #title {
            position: fixed;
            top: 10px;
            left: 10px;
            font-size: 20px;
            letter-spacing: 0.1em;
            z-index: 100;
        }
    </style>


</head>

<body>

    <!-- PRELOADER -->
    <div class="page-loader">
        <div class="loader">Loading...</div>
    </div>
    <!-- /PRELOADER -->

    <!-- OVERLAY MENU -->
    <div id="overlay-menu" class="overlay-menu">

        <a href="index.html#" id="overlay-menu-hide" class="navigation-hide"><i class="ion-close-round"></i></a>

        <div class="overlay-menu-inner">
            <nav class="overlay-menu-nav">

                <ul id="nav">



                    <li><a href="index.html">Why Designers Should Care About Statistics</a></li>
                    <br />
                    <li class="slidedown">
                        <a href="index.html#">101: The Basics, Visualized</a>
                        <ul>
                            <li><a href="sampling.html">Sampling</a></li>
                            <li><a href="typesofstudies.html">Types of Studies</a></li>
                            <li><a href="typesofdata.html">Types of Data</a></li>
                            <li><a href="p.html">Null Hypothesis Testing</a></li>
                        </ul>
                    </li>
                    <br />
                    <li class="slidedown">
                        <a href="index.html#">102: Critical Considerations</a>
                        <ul>
                            <li><a href="validity.html">Validity</a></li>
                            <li><a href="reliability.html">Reliability</a></li>
                            <li><a href="control.html">Experimental Control</a></li>
                            <li><a href="bias.html">Bias</a></li>
                            <li><a href="falsevisualizations.html">False Visualizations</a></li>
                        </ul>
                    </li>


                </ul>

            </nav>
        </div>

        <div class="overlay-navigation-footer">



            <div class="container">

                <div class="row">

                    <div class="col-md-12 text-center">
                        <p class="copyright font-alt m-b-0">Â© 2016 James March</p>
                    </div>

                </div>

            </div>

        </div>

    </div>
    <!-- /OVERLAY MENU -->

    <!-- WRAPPER -->
    <div class="wrapper">

        <!-- NAVIGATION -->
        <nav class="navbar navbar-custom navbar-transparent navbar-light navbar-fixed-top">

            <div class="container">

                <div class="navbar-header">
                    <!-- YOU LOGO HERE -->
                    <a class="navbar-brand" href="index.html">
                        <!-- IMAGE OR SIMPLE TEXT -->
                        <img src="assets/images/data-logo.svg" width="40" alt="">
                    </a>
                </div>

                <!-- ICONS NAVBAR -->
                <ul id="icons-navbar" class="nav navbar-nav navbar-right">
                    <li>
                        <a href="index.html#" id="toggle-menu" class="show-overlay" title="Menu">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                    </li>
                </ul>
                <!-- /ICONS NAVBAR -->

                <ul class="extra-navbar nav navbar-nav navbar-right">

                </ul>

            </div>

        </nav>
        <!-- /NAVIGATION -->

        <!-- HERO -->
        <section class="module module-parallax bg-light-30">
            <div id="totop"></div>

            <!-- HERO TEXT -->





            <div class="container">




                <div class="col-md-12 text-center">
                    <h1 class="mh-line-size-3 font-alt m-b-20">Experimental Control</h1>


                </div>





            </div>
            <!-- /HERO TEXT -->
            <canvas id="waves"></canvas>

        </section>
        <!-- /HERO -->





        <!-- PARAGRAPH -->
        <section class="module">

            <div class="container">


                <!-- MODULE TITLE -->
                <div class="row">


                    <div class="col-md-8 col-md-offset-2">


                        <h5>Smoking causes cancer. Right?</h5>
                    </div>
                </div>
                <!-- /MODULE TITLE -->

                <div class="row">

                    <div class="col-md-8 col-md-offset-2">


                        <p>Let's say we find a bunch of smokers and non-smokers. Over a time of say 20 years, we discover that three times as many smokers have experienced cancer in their lifetime. Can we safely say the aforementioned statement? Not unless we control for all the variour other factors that may have overlapped with the casusal relationships between smoking and cancer. What if everyone also drank Diet Pepsi? What if we only looked at males aged 35-60? What if every participant was caucasian and raised in North America? To what degree could we safely say that smoking causes cancer? Although it seems very resonable to assume that, we cannot assume too much, nor can we determine that one measly correlation infers causation.</p>


                        <p>A scientific control is an experiment or observation designed to minimize the effects of variables other than the independent variable. This increases the reliability of the results, often through a comparison between control measurements and the other measurements. Scientific controls are a part of the scientific method.</p>

                        <P>An example of a scientific control (sometimes called an "experimental control") might be testing plant fertilizer by giving it to only half the plants in a garden: the plants that receive no fertilizer are the control group, because they establish the baseline level of growth that the fertilizer-treated plants will be compared against. Without a control group, the experiment cannot determine whether the fertilizer-treated plants grow more than they would have if untreated.</P>

                        <p>Ideally, all variables in an experiment will be controlled (accounted for by the control measurements) and none will be uncontrolled. In such an experiment, if all the controls work as expected, it is possible to conclude that the experiment is working as intended and that the results of the experiment are due to the effect of the variable being tested. That is, scientific controls allow an investigator to make a claim like <em>"Two situations were identical until factor X occurred. Since factor X is the only difference between the two situations, the new outcome was caused by factor X."</em></p>


                        <p>There are many forms of controlled experiments. A relatively simple one separates research subjects or biological specimens into two groups: an experimental group and a control group. No treatment is given to the control group, while the experimental group is changed according to some key variable of interest, and the two groups are otherwise kept under the same conditions.</p>
                    </div>

                    <div id=tooltip></div>

                    <div class="container">

                        <div class="row">
                            <div class="col-xs-8 col-xs-offset-2 text-center">
                                <h2>Comparison of Drug X and a Control Group (Drug1)</h2>
                                <hr>
                                <div class="row">
                                    <div id="bar1" class="col-xs-6">
                                    </div>
                                    <div id="bar2" class="col-xs-6">
                                    </div>
                                </div>
                                <div class="row">
                                    <div id="bar3" class="col-xs-6">
                                    </div>
                                    <div id="bar4" class="col-xs-6">
                                    </div>
                                </div>
                                <br>
                                <div class="btn-group btn-group-justified " role="group" aria-label="Basic example">
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(1);">Drug1</button>
                                    </div>
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(2);">Drug2</button>
                                    </div>
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(3);">Drug3</button>
                                    </div>
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(4);">Drug4</button>
                                    </div>
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(5);">Drug5</button>
                                    </div>
                                    <div class="btn-group btn-group-sm ">
                                        <button type="button" class="btn btn-default" onclick="selectDrug(6);">Drug6</button>
                                    </div>

                                </div>
                                <br>
                                <br>
                            </div>
                        </div>

                    </div>
                    <div class="col-md-8 col-md-offset-2">

                        <p>Controls eliminate alternate explanations of experimental results, especially experimental errors and experimenter bias. Many controls are specific to the type of experiment being performed, as in the molecular markers used in SDS-PAGE experiments, and may simply have the purpose of ensuring that the equipment is working properly. The selection and use of proper controls to ensure that experimental results are valid (for example, absence of confounding variables) can be very difficult. Control measurements may also be used for other purposes: for example, a measurement of a microphone's background noise in the absence of a signal allows the noise to be subtracted from later measurements of the signal, thus producing a processed signal of higher quality.</p>

                        <p>For example, if a researcher feeds an experimental artificial sweetener to sixty laboratory rats and observes that ten of them subsequently become sick, the underlying cause could be the sweetener itself or something unrelated. Other variables, which may not be readily obvious, may interfere with the experimental design. For instance, perhaps the rats were simply not supplied with enough food or water, or the water was contaminated and undrinkable, or the rats were under some psychological or physiological stress, etc. Eliminating each of these possible explanations individually would be time-consuming and difficult. However, if a control group is used that does not receive the sweetener but is otherwise treated identically, any difference between the two groups can be ascribed to the sweetener itself with much greater confidence.</p>


                        <blockquote>
                            <h5>Randomization</h5> In randomization, the groups that receive different experimental treatments are determined randomly. While this does not ensure that there are no differences between the groups, it ensures that the differences are distributed equally, thus correcting for systematic errors. For example, in experiments where crop yield is affected (e.g. soil fertility), the experiment can be controlled by assigning the treatments to randomly selected plots of land. This mitigates the effect of variations in soil composition on the yield.
                        </blockquote>
                        <blockquote>
                            <h5>Blind experiments</h5> In blind experiments, at least some information is withheld from participants in the experiments (but not the experimenter). For example, to evaluate the success of a medical treatment, an outside expert might be asked to examine blood samples from each of the patients without knowing which patients received the treatment and which did not. If the expert's conclusions as to which samples represent the best outcome correlates with the patients who received the treatment, this allows the experimenter to have much higher confidence that the treatment is effective. The blinding eliminates effects such as confirmation bias and wishful thinking that might occur if the samples were evaluated by someone who knew which samples were in which group.</blockquote>

                        <blockquote>
                            <h5>Double-blind experiments</h5> In double-blind experiments, at least some participants and some experimenters do not possess full information while the experiment is being carried out. Double-blind experiments are most often used in clinical trials of medical treatments, to verify that the supposed effects of the treatment are produced only by the treatment itself. Trials are typically randomized and double-blinded, with two (statistically) identical groups of patients being compared. The treatment group receives the treatment, and the control group receives a placebo. The placebo is the "first" blind, and controls for the patient expectations that come with taking a pill, which can have an effect on patient outcomes. The "second" blind, of the experimenters, controls for the effects on patient expectations due to unintentional differences in the experimenters' behavior. Since the experimenters do not know which patients are in which group, they cannot unconsciously influence the patients. After the experiment is over, they then "unblind" themselves and analyse the results.</blockquote>

                        In clinical trials involving a surgical procedure, a sham operated group is used to ensure that the data reflect the effects of the experiment itself, and are not a consequence of the surgery. In this case, double blinding is achieved by ensuring that the patient does not know whether their surgery was real or sham, and that the experimenters who evaluate patient outcomes are different from the surgeons and do not know which patients are in which group.</p>



                    </div>

                </div>

            </div>

        </section>
        <!-- /PARAGRAPH -->





        <div class="col-md-4 col-md-offset-4">
            <hr class="divider">
        </div>

        <section class="module">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 col-md-offset-3">
                        <h6>References</h6>
                        <code>Lohr, Sharon L. 1999. Sampling: design and analysis. Duxbury.<br />
Kish, Leslie 1995. Survey sampling. Wiley, N.Y. ISBN 0-471-10949-5<br />
Stuart, Alan 1962. Basic ideas of scientific sampling. Hafner, New York.</code>
                    </div>
                </div>
            </div>
        </section>


        <!-- PAGINATION -->
        <section class="module">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 col-md-offset-4 text-center text-italic text-pagination">
                        <A href="reliability.html">&#8592; reliability</A> &#8212;
                        <A href="bias.html">bias &#8594;</A>
                    </div>
                </div>
        </section>
        <!-- /PAGINATION -->

        <!-- FOOTER -->
        <footer class="module bg-light">

            <div class="container">

                <div class="row">

                    <div class="col-md-12">



                    </div>

                </div>

                <div class="row">

                    <div class="col-md-12">

                        <p class="copyright text-center m-b-0">Â© 2016 James March<br /><a href="colophon.html">Colophon &rarr;</a></p>

                    </div>

                </div>

            </div>

        </footer>
        <!-- /FOOTER -->

        </div>
        <!-- /WRAPPER -->

        <!-- SCROLLTOP -->
        <div class="scroll-up">
            <a href="#totop"><i class="fa fa-angle-double-up"></i></a>
        </div>

        <!-- Javascript files -->
        <script src="assets/js/jquery-2.1.3.min.js"></script>
        <script src="assets/bootstrap/js/bootstrap.min.js"></script>
        <script src="assets/js/jquery.superslides.min.js"></script>
        <script src="assets/js/jquery.mb.YTPlayer.min.js"></script>
        <script src="assets/js/jquery.magnific-popup.min.js"></script>
        <script src="assets/js/owl.carousel.min.js"></script>
        <script src="assets/js/jquery.simple-text-rotator.min.js"></script>
        <script src="assets/js/imagesloaded.pkgd.js"></script>
        <script src="assets/js/isotope.pkgd.min.js"></script>
        <script src="assets/js/packery-mode.pkgd.min.js"></script>
        <script src="assets/js/appear.js"></script>
        <script src="assets/js/jquery.easing.1.3.js"></script>
        <script src="assets/js/wow.min.js"></script>
        <script src="assets/js/jqBootstrapValidation.js"></script>
        <script src="assets/js/jquery.fitvids.js"></script>
        <script src="assets/js/jquery.parallax-1.1.3.js"></script>
        <script src="assets/js/smoothscroll.js"></script>
        <script src="http://maps.google.com/maps/api/js?sensor=true"></script>
        <script src="assets/js/gmaps.js"></script>
        <script src="assets/js/contact.js"></script>
        <script src="assets/js/custom.js"></script>
        <script src="assets/js/TweenLite.min.js"></script>
        <script src="assets/js/EasePack.min.js"></script>
        <script src="assets/js/rAF.js"></script>
        <script src='http://codepen.io/jahnreektor/pen/QjOJyo.js'></script>
        <script src='http://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js'></script>
        <script src='https://s3-us-west-2.amazonaws.com/s.cdpn.io/93690/sample_data.js'></script>
        <script type="text/javascript">
            var tooltip = d3.select("#tooltip");
            var mfrs;
            var meanINBI;
            var cvINBIl
            var cvNBDur;

            var bar1 = d3.select("#bar1");
            var bar2 = d3.select("#bar2");
            var bar3 = d3.select("#bar3");
            var bar4 = d3.select("#bar4");


            var frame1 = bar1.append("svg");
            var frame2 = bar2.append("svg");
            var frame3 = bar3.append("svg");
            var frame4 = bar4.append("svg");


            // Set margins, width, and height.
            var margin = {
                top: 20,
                right: 20,
                bottom: 50,
                left: 60
            };
            var frame_width = 250;
            var frame_height = 200;
            var canvas_width = frame_width - margin.left - margin.right;
            var canvas_height = frame_height - margin.top - margin.bottom;



            // Set frame attributes width and height.
            frame1.attr("width", frame_width).attr("height", frame_height);
            frame2.attr("width", frame_width).attr("height", frame_height);
            frame3.attr("width", frame_width).attr("height", frame_height);
            frame4.attr("width", frame_width).attr("height", frame_height);

            // Shift the canvas and make it slightly smaller than the svg canvas.
            var canvas1 = frame1.append("g");
            var canvas2 = frame2.append("g");
            var canvas3 = frame3.append("g");
            var canvas4 = frame4.append("g");

            canvas1.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            canvas2.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            canvas3.attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            canvas4.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

            var yScale1 = d3.scale.linear().range([canvas_height, 0]);
            var yScale2 = d3.scale.linear().range([canvas_height, 0]);
            var yScale3 = d3.scale.linear().range([canvas_height, 0]);
            var yScale4 = d3.scale.linear().range([canvas_height, 0]);


            colors = ["#d62728", "#1f77b4", "#ff7f0e", "#2ca02c", "#9467bd", "#ffff1a", "#00b2b3"];

            d3.csv("https://dulinimendis.github.io/MFRRatioStats.csv", function (error, data) {
                data.forEach(function (d) {
                    d.count = +d.count;
                    d.Value = +d.Value;
                    d.Error = +d.Error;
                });

                mfrs = data.map(function (d) {
                    return d;
                });
                yScale1.domain([d3.min([0, d3.min(data, function (d) {
                    return d.Value + d.Error - 20;
                })]), d3.max(data, function (d) {
                    return d.Value + d.Error;
                })]);
                var yAxis1 = d3.svg.axis().orient("left").scale(yScale1).ticks(5);
                canvas1.append("g").attr("class", "y axis").attr("transform", "translate(0,0)").call(yAxis1);
                canvas1.append("g").attr("class", "x axis").attr("transform", "translate(0," + canvas_height + ")");
                updateBars(data, canvas1, 1, "% Changes in MFR Ratio", yScale1);
            });
            d3.csv("https://dulinimendis.github.io/INBIMeanStats.csv", function (error, data) {
                data.forEach(function (d) {
                    d.count = +d.count;
                    d.Value = +d.Value;
                    d.Error = +d.Error;
                });
                meanINBI = data.map(function (d) {
                    return d;
                });
                yScale2.domain([d3.min([0, d3.min(data, function (d) {
                    return d.Value + d.Error - 20;
                })]), d3.max(data, function (d) {
                    return d.Value + d.Error;
                })]);
                var yAxis2 = d3.svg.axis().orient("left").scale(yScale2).ticks(5);
                canvas2.append("g").attr("class", "y axis").attr("transform", "translate(0,0)").call(yAxis2);
                canvas2.append("g").attr("class", "x axis").attr("transform", "translate(0," + canvas_height + ")");
                updateBars(data, canvas2, 1, "% Changes in mean INBI", yScale2);
            });
            d3.csv("https://dulinimendis.github.io/cvINBIStats.csv", function (error, data) {
                data.forEach(function (d) {
                    d.count = +d.count;
                    d.Value = +d.Value;
                    d.Error = +d.Error;
                });
                cvINBI = data.map(function (d) {
                    return d;
                });
                yScale3.domain([d3.min([0, d3.min(data, function (d) {
                    return d.Value + d.Error - 20;
                })]), d3.max(data, function (d) {
                    return d.Value + d.Error;
                })]);
                var yAxis3 = d3.svg.axis().orient("left").scale(yScale3).ticks(5);
                canvas3.append("g").attr("class", "y axis").attr("transform", "translate(0,0)").call(yAxis3);
                canvas3.append("g").attr("class", "x axis").attr("transform", "translate(0," + canvas_height + ")");
                updateBars(data, canvas3, 1, "% Changes in cv of INBIs", yScale3);
            });
            d3.csv("https://dulinimendis.github.io/cvNBDurStats.csv", function (error, data) {
                data.forEach(function (d) {
                    d.count = +d.count;
                    d.Value = +d.Value;
                    d.Error = +d.Error;
                });
                cvNBDur = data.map(function (d) {
                    return d;
                });
                yScale4.domain([d3.min([0, d3.min(data, function (d) {
                    return d.Value + d.Error - 20;
                })]), d3.max(data, function (d) {
                    return d.Value + d.Error;
                })]);
                var yAxis4 = d3.svg.axis().orient("left").scale(yScale4).ticks(5);
                canvas4.append("g").attr("class", "y axis").attr("transform", "translate(0,0)").call(yAxis4);
                canvas4.append("g").attr("class", "x axis").attr("transform", "translate(0," + canvas_height + ")");
                updateBars(data, canvas4, 1, "% Changes in cv of NB Durations", yScale4);
            });


            function updateBars(dataset, canvas, ind, yAxisName, yScale) {

                dataset = dataset.filter(function (d, i) {
                    return i == 0 || i == ind;
                });

                var xScale = d3.scale.ordinal().domain(dataset.map(function (d) {
                    return d.Label;
                })).rangeRoundBands([0, canvas_width], .1);

                var xAxis = d3.svg.axis().orient("bottom").scale(xScale);

                // Add the x-axis.
                canvas.selectAll(".x.axis").call(xAxis)
                    .selectAll(".tick text").call(wrap, xScale.rangeBand());


                var barWidth = 50;
                var bars = canvas.selectAll(".bar")
                    .data(dataset);

                bars.enter().append("rect")
                    .attr("class", "bar")
                    .attr("x", function (d) {
                        return xScale(d.Label) + (xScale.rangeBand() - barWidth) / 2;
                    })
                    .attr("width", barWidth)
                    .on("mouseover", function (d) {
                        return tooltip.style("visibility", "visible").text(d.Value);
                    })
                    .on("mousemove", function () {
                        return tooltip.style("top", (d3.event.pageY - 10) + "px").style("left", (d3.event.pageX + 10) + "px");
                    })
                    .on("mouseout", function () {
                        return tooltip.style("visibility", "hidden");
                    });

                bars.exit().remove();

                colorsTemp = [colors[0], colors[ind]];

                bars.transition().ease("linear").duration(1000)
                    .style("fill", function (d, i) {
                        return colorsTemp[i];
                    })
                    .attr("y", function (d) {
                        if (d.Value > 0)
                            return yScale(d.Value);
                        else
                            return yScale(0);
                    })
                    .attr("height", function (d) {
                        if (d.Value > 0)
                            return canvas_height - yScale(d.Value) - (canvas_height - yScale(0));
                        else
                            return yScale(d.Value) - yScale(0);
                    });

                var errorsV = canvas.selectAll(".errorVert")
                    .data(dataset);

                errorsV.enter().append("path")
                    .attr("class", "errorVert")
                    .style("fill", "black")
                    .style("stroke", "black");

                errorsV.exit().remove();

                errorsV.transition().ease("linear").duration(1000)
                    .attr("d", function (d) {
                        var xPos = xScale(d.Label) + (xScale.rangeBand() - barWidth) / 2 + barWidth / 2;
                        return "M" + xPos + " " + yScale(d.Value) + "L" + xPos + " " + yScale(d.Value + d.Error);
                    })

                var errorsH = canvas.selectAll(".errorHorz")
                    .data(dataset);

                errorsH.enter().append("path")
                    .attr("class", "errorHorz")
                    .style("fill", "black")
                    .style("stroke", "black");

                errorsH.exit().remove();

                errorsH.transition().ease("linear").duration(1000)
                    .attr("d", function (d) {
                        var xStart = xScale(d.Label) + (xScale.rangeBand() - barWidth) / 2 + barWidth / 2 - barWidth / 8;
                        var xEnd = xScale(d.Label) + (xScale.rangeBand() - barWidth) / 2 + barWidth / 2 + barWidth / 8;
                        return "M" + xStart + " " + yScale(d.Value + d.Error) + "L" + xEnd + " " + yScale(d.Value + d.Error);
                    });

                canvas.selectAll("#yLabel").remove();

                canvas.append("text")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 0 - margin.left)
                    .attr("x", 0 - (canvas_height / 2))
                    .attr("dy", "1em")
                    .style("text-anchor", "middle")
                    .text(yAxisName)
                    .attr("id", "yLabel");

                //Add a line for y=0


                canvas.selectAll("#y0Line").remove();
                canvas.append("g")
                    .attr("class", "0 axis")
                    .append("line")
                    .attr("y1", yScale(0))
                    .attr("y2", yScale(0))
                    .attr("x2", canvas_width)
                    .attr("id", "y0Line");

            }




            function wrap(text, width) {
                text.each(function () {
                    var text = d3.select(this),
                        words = text.text().split(/\s+/).reverse(),
                        word,
                        line = [],
                        lineNumber = 0,
                        lineHeight = 1.1, // ems
                        y = text.attr("y"),
                        dy = parseFloat(text.attr("dy")),
                        tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
                    while (word = words.pop()) {
                        line.push(word);
                        tspan.text(line.join(" "));
                        if (tspan.node().getComputedTextLength() > width) {
                            line.pop();
                            tspan.text(line.join(" "));
                            line = [word];
                            tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                        }
                    }
                });
            }

            function selectDrug(ind) {
                updateBars(mfrs, canvas1, ind, "% Changes in MFR Ratio", yScale1);
                updateBars(meanINBI, canvas2, ind, "% Changes in mean INBI", yScale2);
                updateBars(cvINBI, canvas3, ind, "% Changes in cv of INBIs", yScale3);
                updateBars(cvNBDur, canvas4, ind, "% Changes in cv of NB Durations", yScale4);
            }

            function getMean(data, value) {
                return d3.mean(data, function (d) {
                    return d[value]
                })
            }

            function getSEM(data, value) {
                return (d3.mean(data, function (d) {
                    return d[value]
                })) / Math.sqrt(data.length);
            }
        </script>


        <script type="text/javascript">
            /**
             * Generates multiple customizable animated sines waves
             * using a canvas element. Supports retina displays and
             * limited mobile support
             *
             * I've created a seperate library based on this pen. 
             * Check it out at https://github.com/isuttell/sine-waves
             */
            function SineWaveGenerator(options) {
                $.extend(this, options || {});

                if (!this.el) {
                    throw "No Canvas Selected";
                }
                this.ctx = this.el.getContext('2d');

                if (!this.waves.length) {
                    throw "No waves specified";
                }

                // Internal
                this._resizeWidth();
                window.addEventListener('resize', this._resizeWidth.bind(this));
                // User
                this.resizeEvent();
                window.addEventListener('resize', this.resizeEvent.bind(this));

                if (typeof this.initialize === 'function') {
                    this.initialize.call(this);
                }
                // Start the magic
                this.loop();
            }

            // Defaults
            SineWaveGenerator.prototype.speed = 10;
            SineWaveGenerator.prototype.amplitude = 50;
            SineWaveGenerator.prototype.wavelength = 50;
            SineWaveGenerator.prototype.segmentLength = 10;

            SineWaveGenerator.prototype.lineWidth = 2;
            SineWaveGenerator.prototype.strokeStyle = 'rgba(255, 255, 255, 0.2)';

            SineWaveGenerator.prototype.resizeEvent = function () {};

            // fill the screen
            SineWaveGenerator.prototype._resizeWidth = function () {
                this.dpr = window.devicePixelRatio || 1;

                this.width = this.el.width = window.innerWidth * this.dpr;
                this.height = this.el.height = window.innerHeight * this.dpr;
                this.el.style.width = window.innerWidth + 'px';
                this.el.style.height = window.innerHeight + 'px';

                this.waveWidth = this.width * 0.95;
                this.waveLeft = this.width * 0.025;
            }

            SineWaveGenerator.prototype.clear = function () {
                this.ctx.clearRect(0, 0, this.width, this.height);
            }

            SineWaveGenerator.prototype.time = 0;

            SineWaveGenerator.prototype.update = function (time) {
                this.time = this.time - 0.007;
                if (typeof time === 'undefined') {
                    time = this.time;
                }

                var index = -1;
                var length = this.waves.length;

                while (++index < length) {
                    var timeModifier = this.waves[index].timeModifier || 1;
                    this.drawSine(time * timeModifier, this.waves[index]);
                }
                index = void 0;
                length = void 0;
            }

            // Constants
            var PI2 = Math.PI * 2;
            var HALFPI = Math.PI / 2;

            SineWaveGenerator.prototype.ease = function (percent, amplitude) {
                return amplitude * (Math.sin(percent * PI2 - HALFPI) + 1) * 0.5;
            }

            SineWaveGenerator.prototype.drawSine = function (time, options) {
                options = options || {};
                amplitude = options.amplitude || this.amplitude;
                wavelength = options.wavelength || this.wavelength;
                lineWidth = options.lineWidth || this.lineWidth;
                strokeStyle = options.strokeStyle || this.strokeStyle;
                segmentLength = options.segmentLength || this.segmentLength;

                var x = time;
                var y = 0;
                var amp = this.amplitude;

                // Center the waves
                var yAxis = this.height / 2;

                // Styles
                this.ctx.lineWidth = lineWidth * this.dpr;
                this.ctx.strokeStyle = strokeStyle;
                this.ctx.lineCap = 'round';
                this.ctx.lineJoin = 'round';
                this.ctx.beginPath();

                // Starting Line
                this.ctx.moveTo(0, yAxis);
                this.ctx.lineTo(this.waveLeft, yAxis);

                for (var i = 0; i < this.waveWidth; i += segmentLength) {
                    x = (time * this.speed) + (-yAxis + i) / wavelength;
                    y = Math.sin(x);

                    // Easing
                    amp = this.ease(i / this.waveWidth, amplitude);

                    this.ctx.lineTo(i + this.waveLeft, amp * y + yAxis);

                    amp = void 0;
                }

                // Ending Line
                this.ctx.lineTo(this.width, yAxis);

                // Stroke it
                this.ctx.stroke();

                // Clean up
                options = void 0;
                amplitude = void 0;
                wavelength = void 0;
                lineWidth = void 0;
                strokeStyle = void 0;
                segmentLength = void 0;
                x = void 0;
                y = void 0;
            }

            SineWaveGenerator.prototype.loop = function () {
                this.clear();
                this.update();

                window.requestAnimationFrame(this.loop.bind(this));
            }

            new SineWaveGenerator({
                el: document.getElementById('waves'),

                speed: 8,

                waves: [
                    {
                        timeModifier: 1,
                        lineWidth: 3,
                        amplitude: 150,
                        wavelength: 200,
                        segmentLength: 20,
                        //       strokeStyle: 'rgba(255, 255, 255, 0.5)'
    },
                    {
                        timeModifier: 1,
                        lineWidth: 2,
                        amplitude: 150,
                        wavelength: 100,
                        //       strokeStyle: 'rgba(255, 255, 255, 0.3)'
    },
                    {
                        timeModifier: 1,
                        lineWidth: 1,
                        amplitude: -150,
                        wavelength: 50,
                        segmentLength: 10,
                        //       strokeStyle: 'rgba(255, 255, 255, 0.2)'
    },
                    {
                        timeModifier: 1,
                        lineWidth: 0.5,
                        amplitude: -100,
                        wavelength: 100,
                        segmentLength: 10,
                        //       strokeStyle: 'rgba(255, 255, 255, 0.1)'
    }
  ],

                initialize: function () {

                },

                resizeEvent: function () {
                    var gradient = this.ctx.createLinearGradient(0, 0, this.width, 0);
                    gradient.addColorStop(0, "rgba(0, 0, 0, 0)");
                    gradient.addColorStop(0.5, "rgba(255, 255, 255, 0.5)");
                    gradient.addColorStop(1, "rgba(0, 0, 0, 0)");

                    var index = -1;
                    var length = this.waves.length;
                    while (++index < length) {
                        this.waves[index].strokeStyle = gradient;
                    }

                    // Clean Up
                    index = void 0;
                    length = void 0;
                    gradient = void 0;
                }
            });
        </script>

</body>

</html>